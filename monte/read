import matplotlib.pyplot as plt
from matplotlib.patches import Rectangle, Circle
import numpy as np
from copy import copy
from scipy.spatial import distance


small =[[1.0398579968, 0.0, 9.9457878193], [-1.0398579968, 1.27345876735e-16, 9.9457878193], [2.99824762333, 0.0, 9.53994293427], [2.29679093095, 1.92723642305, 9.53994293427], [0.520640235985, 2.95269750491, 9.53994293427], [-1.49912381167, 2.59655860864, 9.53994293427], [-2.81743116693, 1.02546108186, 9.53994293427], [-2.81743116693, -1.02546108186, 9.53994293427], [-1.49912381167, -2.59655860864, 9.53994293427], [0.520640235985, -2.95269750491, 9.53994293427], [2.29679093095, -1.92723642305, 9.53994293427], [4.83670734493, 0.0, 8.75250033188], [4.4185520249, 1.96726610902, 8.75250033188], [3.23638891849, 3.59437403573, 8.75250033188], [1.4946247664, 4.59998203781, 8.75250033188], [-0.505573586041, 4.81021135602, 8.75250033188], [-2.41835367246, 4.18871143138, 8.75250033188], [-3.91297843886, 2.842945247, 8.75250033188], [-4.73101368489, 1.00560800207, 8.75250033188], [-4.73101368489, -1.00560800207, 8.75250033188], [-3.91297843886, -2.842945247, 8.75250033188], [-2.41835367246, -4.18871143138, 8.75250033188], [-0.505573586041, -4.81021135602, 8.75250033188], [1.4946247664, -4.59998203781, 8.75250033188], [3.23638891849, -3.59437403573, 8.75250033188], [4.4185520249, -1.96726610902, 8.75250033188], [6.48169877273, 0.0, 7.61495771621], [6.16446185446, 2.00295507319, 7.61495771621], [5.24380445955, 3.80984694841, 7.61495771621], [3.80984694841, 5.24380445955, 7.61495771621], [2.00295507319, 6.16446185446, 7.61495771621], [3.96889582753e-16, 6.48169877273, 7.61495771621], [-2.00295507319, 6.16446185446, 7.61495771621], [-3.80984694841, 5.24380445955, 7.61495771621], [-5.24380445955, 3.80984694841, 7.61495771621], [-6.16446185446, 2.00295507319, 7.61495771621], [-6.48169877273, 7.93779165506e-16, 7.61495771621], [-6.16446185446, -2.00295507319, 7.61495771621], [-5.24380445955, -3.80984694841, 7.61495771621], [-3.80984694841, -5.24380445955, 7.61495771621], [-2.00295507319, -6.16446185446, 7.61495771621], [-1.19066874826e-15, -6.48169877273, 7.61495771621], [2.00295507319, -6.16446185446, 7.61495771621], [3.80984694841, -5.24380445955, 7.61495771621], [5.24380445955, -3.80984694841, 7.61495771621], [6.16446185446, -2.00295507319, 7.61495771621], [7.86742224962, 0.0, 6.17281679189], [7.59934633723, 2.03623871406, 6.17281679189], [6.81338753047, 3.93371112481, 6.17281679189], [5.56310762316, 5.56310762316, 6.17281679189], [3.93371112481, 6.81338753047, 6.17281679189], [2.03623871406, 7.59934633723, 6.17281679189], [4.81740673777e-16, 7.86742224962, 6.17281679189], [-2.03623871406, 7.59934633723, 6.17281679189], [-3.93371112481, 6.81338753047, 6.17281679189], [-5.56310762316, 5.56310762316, 6.17281679189], [-6.81338753047, 3.93371112481, 6.17281679189], [-7.59934633723, 2.03623871406, 6.17281679189], [-7.86742224962, 9.63481347553e-16, 6.17281679189], [-7.59934633723, -2.03623871406, 6.17281679189], [-6.81338753047, -3.93371112481, 6.17281679189], [-5.56310762316, -5.56310762316, 6.17281679189], [-3.93371112481, -6.81338753047, 6.17281679189], [-2.03623871406, -7.59934633723, 6.17281679189], [-1.44522202133e-15, -7.86742224962, 6.17281679189], [2.03623871406, -7.59934633723, 6.17281679189], [3.93371112481, -6.81338753047, 6.17281679189], [5.56310762316, -5.56310762316, 6.17281679189], [6.81338753047, -3.93371112481, 6.17281679189], [7.59934633723, -2.03623871406, 6.17281679189], [8.93844883652, 0.0, 4.4837631959], [8.71434326234, 1.98899198322, 4.4837631959], [8.05326412905, 3.8782476031, 4.4837631959], [6.98836070482, 5.57303169401, 4.4837631959], [5.57303169401, 6.98836070482, 4.4837631959], [3.8782476031, 8.05326412905, 4.4837631959], [1.98899198322, 8.71434326234, 4.4837631959], [5.47322137849e-16, 8.93844883652, 4.4837631959], [-1.98899198322, 8.71434326234, 4.4837631959], [-3.8782476031, 8.05326412905, 4.4837631959], [-5.57303169401, 6.98836070482, 4.4837631959], [-6.98836070482, 5.57303169401, 4.4837631959], [-8.05326412905, 3.8782476031, 4.4837631959], [-8.71434326234, 1.98899198322, 4.4837631959], [-8.93844883652, 1.0946442757e-15, 4.4837631959], [-8.71434326234, -1.98899198322, 4.4837631959], [-8.05326412905, -3.8782476031, 4.4837631959], [-6.98836070482, -5.57303169401, 4.4837631959], [-5.57303169401, -6.98836070482, 4.4837631959], [-3.8782476031, -8.05326412905, 4.4837631959], [-1.98899198322, -8.71434326234, 4.4837631959], [-1.64196641355e-15, -8.93844883652, 4.4837631959], [1.98899198322, -8.71434326234, 4.4837631959], [3.8782476031, -8.05326412905, 4.4837631959], [5.57303169401, -6.98836070482, 4.4837631959], [6.98836070482, -5.57303169401, 4.4837631959], [8.05326412905, -3.8782476031, 4.4837631959], [8.71434326234, -1.98899198322, 4.4837631959], [9.65193746997, 0.0, 2.61535907207], [9.44101947868, 2.00675063905, 2.61535907207], [8.81748363314, 3.92579664571, 2.61535907207], [7.80858144185, 5.6732665009, 2.61535907207], [6.45840677182, 7.17278738664, 2.61535907207], [4.82596873498, 8.35882304473, 2.61535907207], [2.98261270686, 9.17953802569, 2.61535907207], [1.00890219129, 9.59906314661, 2.61535907207], [-1.00890219129, 9.59906314661, 2.61535907207], [-2.98261270686, 9.17953802569, 2.61535907207], [-4.82596873498, 8.35882304473, 2.61535907207], [-6.45840677182, 7.17278738664, 2.61535907207], [-7.80858144185, 5.6732665009, 2.61535907207], [-8.81748363314, 3.92579664571, 2.61535907207], [-9.44101947868, 2.00675063905, 2.61535907207], [-9.65193746997, 1.18202143282e-15, 2.61535907207], [-9.44101947868, -2.00675063905, 2.61535907207], [-8.81748363314, -3.92579664571, 2.61535907207], [-7.80858144185, -5.6732665009, 2.61535907207], [-6.45840677182, -7.17278738664, 2.61535907207], [-4.82596873498, -8.35882304473, 2.61535907207], [-2.98261270686, -9.17953802569, 2.61535907207], [-1.00890219129, -9.59906314661, 2.61535907207], [1.00890219129, -9.59906314661, 2.61535907207], [2.98261270686, -9.17953802569, 2.61535907207], [4.82596873498, -8.35882304473, 2.61535907207], [6.45840677182, -7.17278738664, 2.61535907207], [7.80858144185, -5.6732665009, 2.61535907207], [8.81748363314, -3.92579664571, 2.61535907207], [9.44101947868, -2.00675063905, 2.61535907207], [9.97934860461, 0.0, 0.642340585353], [9.77507075242, 2.00882810556, 0.642340585353], [9.17060035509, 3.93541455245, 0.642340585353], [8.19068450173, 5.70088466517, 0.642340585353], [6.8754410625, 7.23295988987, 0.642340585353], [5.27871625835, 8.46891688684, 0.642340585353], [3.46588019035, 9.35815543142, 0.642340585353], [1.51115058014, 9.86426999309, 0.642340585353], [-0.505445712375, 9.96654018224, 0.642340585353], [-2.50134899804, 9.66077904532, 0.642340585353], [-4.39484676183, 8.95950447918, 0.642340585353], [-6.10841898281, 7.89142674697, 0.642340585353], [-7.57191181293, 6.50027307654, 0.642340585353], [-8.72540968377, 4.8429974626, 0.642340585353], [-9.52168825696, 2.98744896352, 0.642340585353], [-9.92814779416, 1.00959395286, 0.642340585353], [-9.92814779416, -1.00959395286, 0.642340585353], [-9.52168825696, -2.98744896352, 0.642340585353], [-8.72540968377, -4.8429974626, 0.642340585353], [-7.57191181293, -6.50027307654, 0.642340585353], [-6.10841898281, -7.89142674697, 0.642340585353], [-4.39484676183, -8.95950447918, 0.642340585353], [-2.50134899804, -9.66077904532, 0.642340585353], [-0.505445712375, -9.96654018224, 0.642340585353], [1.51115058014, -9.86426999309, 0.642340585353], [3.46588019035, -9.35815543142, 0.642340585353], [5.27871625835, -8.46891688684, 0.642340585353], [6.8754410625, -7.23295988987, 0.642340585353], [8.19068450173, -5.70088466517, 0.642340585353], [9.17060035509, -3.93541455245, 0.642340585353], [9.77507075242, -2.00882810556, 0.642340585353], [9.90758579508, 0.0, -1.35637152477], [9.7047769318, 1.9943823582, -1.35637152477], [9.10465336068, 3.90711446833, -1.35637152477], [8.13178421122, 5.65988885305, -1.35637152477], [6.82599886071, 7.18094672312, -1.35637152477], [5.24075631482, 8.40801579063, -1.35637152477], [3.44095658964, 9.29085970376, -1.35637152477], [1.50028369738, 9.793334729, -1.35637152477], [-0.501810985719, 9.89486947976, -1.35637152477], [-2.48336146811, 9.59130711142, -1.35637152477], [-4.36324284021, 8.89507550301, -1.35637152477], [-6.06449253777, 7.83467845837, -1.35637152477], [-7.51746119829, 6.45352875712, -1.35637152477], [-8.66266411409, 4.8081708303, -1.35637152477], [-9.45321654323, 2.96596582474, -1.35637152477], [-9.85675317639, 1.00233382983, -1.35637152477], [-9.85675317639, -1.00233382983, -1.35637152477], [-9.45321654323, -2.96596582474, -1.35637152477], [-8.66266411409, -4.8081708303, -1.35637152477], [-7.51746119829, -6.45352875712, -1.35637152477], [-6.06449253777, -7.83467845837, -1.35637152477], [-4.36324284021, -8.89507550301, -1.35637152477], [-2.48336146811, -9.59130711142, -1.35637152477], [-0.501810985719, -9.89486947976, -1.35637152477], [1.50028369738, -9.793334729, -1.35637152477], [3.44095658964, -9.29085970376, -1.35637152477], [5.24075631482, -8.40801579063, -1.35637152477], [6.82599886071, -7.18094672312, -1.35637152477], [8.13178421122, -5.65988885305, -1.35637152477], [9.10465336068, -3.90711446833, -1.35637152477], [9.7047769318, -1.9943823582, -1.35637152477], [9.43951955373, 0.0, -3.30082877391], [9.2188288322, 2.02921767385, -3.30082877391], [8.56707592047, 3.96355138458, -3.30082877391], [7.51473606032, 5.71255383774, -3.30082877391], [6.11101549402, 7.19444362249, -3.30082877391], [4.42155063512, 8.33992921951, -3.30082877391], [2.52533898272, 9.09544899539, -3.30082877391], [0.51104528621, 9.4256756851, -3.30082877391], [-1.5271443199, 9.31516825567, -3.30082877391], [-3.49392635491, 8.76909391167, -3.30082877391], [-5.29733627679, 7.81298648251, -3.30082877391], [-6.85304864193, 6.49155248894, -3.30082877391], [-8.08832006919, 4.86658071583, -3.30082877391], [-8.94539063954, 3.01405303726, -3.30082877391], [-9.38418468567, 1.02059158854, -3.30082877391], [-9.38418468567, -1.02059158854, -3.30082877391], [-8.94539063954, -3.01405303726, -3.30082877391], [-8.08832006919, -4.86658071583, -3.30082877391], [-6.85304864193, -6.49155248894, -3.30082877391], [-5.29733627679, -7.81298648251, -3.30082877391], [-3.49392635491, -8.76909391167, -3.30082877391], [-1.5271443199, -9.31516825567, -3.30082877391], [0.51104528621, -9.4256756851, -3.30082877391], [2.52533898272, -9.09544899539, -3.30082877391], [4.42155063512, -8.33992921951, -3.30082877391], [6.11101549402, -7.19444362249, -3.30082877391], [7.51473606032, -5.71255383774, -3.30082877391], [8.56707592047, -3.96355138458, -3.30082877391], [9.2188288322, -2.02921767385, -3.30082877391], [8.59387253024, 0.0, -5.11325287209], [8.34415021324, 2.05664831338, -5.11325287209], [7.6094962156, 3.99377170239, -5.11325287209], [6.4326059573, 5.69879159684, -5.11325287209], [4.88187602233, 7.07261843794, -5.11325287209], [3.04742919784, 8.03541040335, -5.11325287209], [1.03587686533, 8.53121352364, -5.11325287209], [-1.03587686533, 8.53121352364, -5.11325287209], [-3.04742919784, 8.03541040335, -5.11325287209], [-4.88187602233, 7.07261843794, -5.11325287209], [-6.4326059573, 5.69879159684, -5.11325287209], [-7.6094962156, 3.99377170239, -5.11325287209], [-8.34415021324, 2.05664831338, -5.11325287209], [-8.59387253024, 1.05244584864e-15, -5.11325287209], [-8.34415021324, -2.05664831338, -5.11325287209], [-7.6094962156, -3.99377170239, -5.11325287209], [-6.4326059573, -5.69879159684, -5.11325287209], [-4.88187602233, -7.07261843794, -5.11325287209], [-3.04742919784, -8.03541040335, -5.11325287209], [-1.03587686533, -8.53121352364, -5.11325287209], [1.03587686533, -8.53121352364, -5.11325287209], [3.04742919784, -8.03541040335, -5.11325287209], [4.88187602233, -7.07261843794, -5.11325287209], [6.4326059573, -5.69879159684, -5.11325287209], [7.6094962156, -3.99377170239, -5.11325287209], [8.34415021324, -2.05664831338, -5.11325287209], [7.40447060554, 0.0, -6.72114685538], [7.12989274974, 1.9977022615, -6.72114685538], [6.32652336577, 3.84724408515, -6.72114685538], [5.05394468568, 5.41145341497, -6.72114685538], [3.40653804852, 6.57432000076, -6.72114685538], [1.50648406817, 7.2495993476, -6.72114685538], [-0.50529894381, 7.38720907554, -6.72114685538], [-2.47960624472, 6.97694330058, -6.72114685538], [-4.27001249389, 6.04922955841, -6.72114685538], [-5.74373145041, 4.67287213327, -6.72114685538], [-6.79146412107, 2.94994915898, -6.72114685538], [-7.33550496675, 1.00824195069, -6.72114685538], [-7.33550496675, -1.00824195069, -6.72114685538], [-6.79146412107, -2.94994915898, -6.72114685538], [-5.74373145041, -4.67287213327, -6.72114685538], [-4.27001249389, -6.04922955841, -6.72114685538], [-2.47960624472, -6.97694330058, -6.72114685538], [-0.50529894381, -7.38720907554, -6.72114685538], [1.50648406817, -7.2495993476, -6.72114685538], [3.40653804852, -6.57432000076, -6.72114685538], [5.05394468568, -5.41145341497, -6.72114685538], [6.32652336577, -3.84724408515, -6.72114685538], [7.12989274974, -1.9977022615, -6.72114685538], [5.91888985662, 0.0, -8.06019496447], [5.56193712151, 2.02437955709, -8.06019496447], [4.5341326841, 3.80458906294, -8.06019496447], [2.95944492831, 5.12590897804, -8.06019496447], [1.02780443741, 5.82896862003, -8.06019496447], [-1.02780443741, 5.82896862003, -8.06019496447], [-2.95944492831, 5.12590897804, -8.06019496447], [-4.5341326841, 3.80458906294, -8.06019496447], [-5.56193712151, 2.02437955709, -8.06019496447], [-5.91888985662, 7.24854951742e-16, -8.06019496447], [-5.56193712151, -2.02437955709, -8.06019496447], [-4.5341326841, -3.80458906294, -8.06019496447], [-2.95944492831, -5.12590897804, -8.06019496447], [-1.02780443741, -5.82896862003, -8.06019496447], [1.02780443741, -5.82896862003, -8.06019496447], [2.95944492831, -5.12590897804, -8.06019496447], [4.5341326841, -3.80458906294, -8.06019496447], [5.56193712151, -2.02437955709, -8.06019496447], [4.19655351343, 0.0, -9.07683527497], [3.71586359545, 1.95023566041, -9.07683527497], [2.38391410875, 3.45369583392, -9.07683527497], [0.505838629023, 4.16595591341, -9.07683527497], [-1.4881183846, 3.92384569836, -9.07683527497], [-3.14116541008, 2.78282972128, -9.07683527497], [-4.07460929526, 1.00430099179, -9.07683527497], [-4.07460929526, -1.00430099179, -9.07683527497], [-3.14116541008, -2.78282972128, -9.07683527497], [-1.4881183846, -3.92384569836, -9.07683527497], [0.505838629023, -4.16595591341, -9.07683527497], [2.38391410875, -3.45369583392, -9.07683527497], [3.71586359545, -1.95023566041, -9.07683527497], [2.30635502971, 0.0, -9.73040217447], [1.43798884049, 1.80318097198, -9.73040217447], [-0.513212275246, 2.24852989386, -9.73040217447], [-2.0779540801, 1.00068994402, -9.73040217447], [-2.0779540801, -1.00068994402, -9.73040217447], [-0.513212275246, -2.24852989386, -9.73040217447], [1.43798884049, -1.80318097198, -9.73040217447], [1.22464679915e-15, 0.0, -10.0]]

overlap = 0
nums = []
list = []

def readdata(data):
    with open('datafile.xyz', "r") as infile :
        natoms = int(infile.readline())
        infile.readline()
        positionlist=[]
        for ii in range(natoms):
            line=infile.readline()
            sline=line.split()
            positionlist.append([float(sline[1]), float(sline[2]), float(sline[3]) ])
        print(positionlist)
        exit()
    data = positionlist



# output file
def writefile(list):
    f = open("datafile.xyz", "w")
    f.write(str(len(list)) + '\n' + '\n')
    for n in range(len(list)):
        f.write(str(1) + " " + str(list[n][0]) + " " + str(list[n][1]) + " " + str(list[n][2]) + "\n")


# random point on sphere
def random(x0, y0, z0, radius):
    u = np.random.uniform()
    v = np.random.uniform()
    theta = 2 * np.pi * u
    phi = np.arccos(2 * v - 1)
    x = x0 + (radius * np.sin(phi) * np.cos(theta))
    y = y0 + (radius * np.sin(phi) * np.sin(theta))
    z = z0 + (radius * np.cos(phi))
    return [x, y, z]


# rotate 1 ball
def rotate(random1, random2, list):
    theta = np.arctan(list[1] / list[0])
    phi = np.arccos(list[2] / 10)
    theta += random1
    phi += random2
    x = (10 * np.sin(phi) * np.cos(theta))
    y = (10 * np.sin(phi) * np.sin(theta))
    z = (10 * np.cos(phi))
    return [x, y, z]


# main
def num():
    small.append(random(0, 0, 0, 10))
    for i in range(5000):
        new1 = random(0, 0, 0, 10)
        if check(new1):
            small.append(new1)
    print(len(small))


# number of no overlap pair
def numberofok():
    ok = 0
    lens=len(small)
    for id in range(lens):
        i=small[id]
        for j in small[id+1:]:

            if ((j[1] - i[1]) ** 2 + (j[2] - i[2]) ** 2 + (j[0] - i[0]) ** 2) >= 4:
                ok += 1
                print(str(i) + " " + str(j) + " " + str(((j[1] - i[1]) ** 2 + (j[2] - i[2]) ** 2 + (j[0] - i[0]) ** 2)))
            else:

                print(str(i) + " " + str(j) + " " + str(((j[1] - i[1]) ** 2 + (j[2] - i[2]) ** 2 + (j[0] - i[0]) ** 2)) )
    print(ok)



# check whether a pair overlap    new is not in the list
def check(new):
    ok = 0
    for j in small:
        if distance.euclidean(np.asarray(j), np.asarray(new)) >= 2:
            ok += 1
    if ok == len(small):
        return "true"


# shift one ball
def shift(l):
    #l[0] += np.random.uniform(-0.2, 0.2)
    #l[1] += np.random.uniform(-0.2, 0.2)
    l[2] += np.random.uniform(0.1, 0.2)
    mag = distance.euclidean(np.asarray(l), (0, 0, 0))
    l[0] *= (10. / float(mag))
    l[1] *= (10. / float(mag))
    l[2] *= (10. / float(mag))


# try to add one
def addone():
    for i in range(50):
        for s in range(len(small)):
            temp=[ss for ss in small[s]]
            shift(small[s])
            new3=[ss for ss in small[s]]
            small[s]=[100,0,0]
            if check(new3):
                small[s]=[ss for ss in new3]
            else:
                small[s]=[ss for ss in temp]


        for i in range(300):
            new4 = random(0, 0, 0, 10)
            if check(new4):
                small.append(new4)
                print("yeah")
        print("o")



readdata(small)



print(len(small))
npsmall=np.array(small)
exit()
numberofok()
addone()
numberofok()
print(len(small))
print(small)

for i in small:
    rotate(1.57, 1.57, i)
addone()
for i in small:
    rotate(1.57, 1.57, i)
addone()
for i in small:
    rotate(1.57, 1.57, i)
addone()
numberofok()
print(len(small))
print(small)
writefile(small)
